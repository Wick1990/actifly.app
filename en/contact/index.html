<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Contact — ActiFly</title>
    <meta
      name="description"
      content="Get in touch with ActiFly. Questions, feedback, or support — we’re here to help."
    />

    <link rel="canonical" href="https://actifly.app/en/contact/" />
    <link rel="manifest" href="/manifest.webmanifest" />
    <link rel="icon" href="/assets/logo.webp" />

    <meta property="og:title" content="Contact — ActiFly" />
    <meta
      property="og:description"
      content="Questions, feedback, or support? Contact the ActiFly team anytime."
    />
    <meta property="og:image" content="/assets/logo.webp" />

    <link rel="stylesheet" href="/styles.css" />

    <style>
      /* Contact: tidy form layout inside heroCard */
      .contactForm .field {
        display: grid;
        gap: 8px;
        margin-top: 12px;
      }
      .contactForm .label {
        display: block;
      }
      .contactForm .input {
        width: 100%;
      }
      .contactForm textarea.input {
        resize: vertical;
        min-height: 140px;
      }
      .contactForm .actions {
        margin-top: 14px;
        justify-content: center;
      }
      .contactHint {
        margin-top: 10px;
        text-align: center;
        min-height: 20px;
      }

      /* Attachment preview */
      .attachBox {
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 14px;
        padding: 10px 12px;
        background: rgba(0, 0, 0, 0.08);
      }
      .attachList {
        list-style: none;
        padding: 0;
        margin: 8px 0 0;
        display: grid;
        gap: 8px;
      }
      .attachItem {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        font-size: 13px;
        opacity: 0.95;
      }
      .attachLeft {
        display: flex;
        align-items: center;
        gap: 10px;
        min-width: 0;
      }
      .attachName {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        max-width: 260px;
      }
      .attachMeta {
        opacity: 0.75;
        white-space: nowrap;
      }
      .attachNote {
        margin-top: 6px;
        opacity: 0.75;
        font-size: 12px;
      }
      .attachWarn {
        margin-top: 8px;
        font-size: 12px;
        color: #ffd38a;
      }

      /* Remove button (uses your existing button styling vibe, but local) */
      .btnMini {
        border: 1px solid rgba(255, 255, 255, 0.16);
        background: rgba(0, 0, 0, 0.14);
        border-radius: 999px;
        padding: 6px 10px;
        font-size: 12px;
        cursor: pointer;
        color: inherit;
        transition: transform 0.08s ease, background 0.15s ease;
      }
      .btnMini:hover {
        background: rgba(0, 0, 0, 0.22);
      }
      .btnMini:active {
        transform: translateY(1px);
      }
      .btnMini:disabled {
        opacity: 0.55;
        cursor: not-allowed;
      }
    </style>
  </head>

  <body>
    <a class="skipLink" href="#main">Skip to content</a>

    <!-- Header -->
    <header class="siteHeader">
      <div class="container">
        <div class="topbar">
          <a class="brand" href="/en/" aria-label="ActiFly home">
            <span class="icon" aria-hidden="true">
              <img src="/assets/logo.webp" alt="" width="48" height="48" decoding="async" />
            </span>
            <img class="wm" src="/assets/wordmark.webp" alt="ActiFly" decoding="async" />
          </a>

          <div class="navWrap">
            <nav class="nav" aria-label="Primary">
              <a href="/en/">Home</a>
              <a href="/en/how-it-works/">How it works</a>
              <a href="/en/safety/">Safety</a>
              <a href="/en/faq/">FAQ</a>
              <a href="/en/about/">About</a>
              <a href="/en/contact/" aria-current="page">Contact</a>
            </nav>

            <div class="lang" aria-label="Language">
              <button type="button" data-lang="de">DE</button>
              <button type="button" data-lang="en">EN</button>
              <button type="button" data-lang="fr">FR</button>
              <button type="button" data-lang="lb">LU</button>
              <button type="button" data-lang="nl">NL</button>
              <button type="button" data-lang="es">ES</button>
              <button type="button" data-lang="it">IT</button>
              <button type="button" data-lang="pt">PT</button>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Big logo -->
    <section class="section section--logo">
      <div class="container" style="text-align: center;">
        <div class="sectionHeader srOnly">
          <h2 class="h2">Brand</h2>
          <p class="p">ActiFly logo</p>
        </div>

        <img
          src="/assets/logo-light.webp"
          alt="ActiFly"
          style="max-width: 520px; width: 86%; height: auto;"
          decoding="async"
        />
      </div>
    </section>

    <main id="main">
      <!-- HERO -->
      <section class="section section--hero">
        <div class="container">
          <div class="hero">
            <!-- Left copy -->
            <div>
              <div class="kickerRow">
                <span class="badge">Contact</span>
                <span class="small">Support, feedback, and questions.</span>
              </div>

              <h1 class="h1">Get in touch with ActiFly</h1>
              <p class="p">
                Questions, feedback, or something you’re unsure about?
                Send us a message — we usually reply within 24–48 hours on business days.
              </p>

              <div class="actions" role="group" aria-label="Primary actions">
                <a class="btn btn--primary" href="/en/faq/">Read FAQ</a>
                <a class="btn btn--ghost" href="mailto:support@actifly.app">Email us</a>
              </div>

              <!-- WHAT TO INCLUDE -->
              <div class="sectionHeader" style="margin-top: 22px; margin-bottom: 10px;">
                <h2 class="h2" style="font-size: 22px;">What to include</h2>
                <p class="p">This helps us respond faster and more accurately.</p>
              </div>

              <div class="grid3">
                <div class="card card--feature">
                  <h3 class="h3">Your question</h3>
                  <p class="small">Describe what you need help with or what you’d like to know.</p>
                </div>

                <div class="card card--feature">
                  <h3 class="h3">Device & app version</h3>
                  <p class="small">Especially useful if you’re reporting a technical issue.</p>
                </div>

                <div class="card card--feature">
                  <h3 class="h3">Screenshots (optional)</h3>
                  <p class="small">Visual context can help us understand the issue quicker.</p>
                </div>
              </div>
            </div>

            <!-- Right form card -->
            <aside class="heroCard" aria-label="Contact form">
              <div class="sectionHeader" style="margin-bottom: 12px;">
                <h2 class="h2">Contact support</h2>
                <p class="small">Use this form to reach us directly.</p>
              </div>

              <form id="contactForm" class="contactForm" novalidate>
                <div class="field">
                  <label class="label" for="email">Email *</label>
                  <input class="input" id="email" type="email" name="email" required />
                </div>

                <div class="field">
                  <label class="label" for="category">Category *</label>
                  <select class="input" id="category" name="category" required>
                    <option value="">Select a category</option>
                    <option>General question</option>
                    <option>Technical issue</option>
                    <option>Safety concern</option>
                    <option>Feedback / suggestion</option>
                    <option>Other</option>
                  </select>
                </div>

                <div class="field">
                  <label class="label" for="subject">Subject</label>
                  <input class="input" id="subject" type="text" name="subject" />
                </div>

                <div class="field">
                  <label class="label" for="message">Message *</label>
                  <textarea class="input" id="message" name="message" rows="5" required></textarea>
                </div>

                <div class="field">
                  <label class="label" for="attachments">Attachments (optional)</label>
                  <input
                    class="input"
                    id="attachments"
                    type="file"
                    accept="image/png,image/jpeg,image/webp,application/pdf"
                    multiple
                  />

                  <div class="attachBox" style="margin-top: 8px;">
                    <div class="small" style="margin: 0;">
                      Up to 3 files. Max 5 MB each. (PNG/JPG/WEBP/PDF)
                    </div>

                    <ul id="attachList" class="attachList" aria-live="polite"></ul>
                    <div id="attachSummary" class="attachNote"></div>
                    <div id="attachWarning" class="attachWarn" role="status"></div>
                  </div>
                </div>

                <div class="actions">
                  <button id="submitBtn" class="btn btn--primary" type="submit">Send message</button>
                </div>

                <p id="formStatus" class="small contactHint" aria-live="polite"></p>
              </form>
            </aside>
          </div>
        </div>
      </section>

      <script>
        window.addEventListener("DOMContentLoaded", () => {
          const form = document.getElementById("contactForm");
          const status = document.getElementById("formStatus");
          const fileInput = document.getElementById("attachments");
          const attachList = document.getElementById("attachList");
          const attachSummary = document.getElementById("attachSummary");
          const attachWarning = document.getElementById("attachWarning");
          const submitBtn = document.getElementById("submitBtn");

          if (!form || !status || !fileInput || !attachList || !attachSummary || !attachWarning || !submitBtn) return;

          const MAX_FILES = 3;
          const MAX_MB = 5;
          const MAX_BYTES = MAX_MB * 1024 * 1024;

          /** We keep our own list because input.files is read-only */
          let selectedFiles = [];

          function fmtBytes(bytes) {
            const mb = bytes / (1024 * 1024);
            return `${mb.toFixed(mb >= 10 ? 0 : 1)} MB`;
          }

          function escapeHtml(str) {
            return String(str)
              .replaceAll("&", "&amp;")
              .replaceAll("<", "&lt;")
              .replaceAll(">", "&gt;")
              .replaceAll('"', "&quot;")
              .replaceAll("'", "&#039;");
          }

          function validateFiles(files) {
            const tooMany = files.length > MAX_FILES;
            const tooLarge = files.some((f) => f.size > MAX_BYTES);
            return { tooMany, tooLarge };
          }

          function renderFiles() {
            attachList.innerHTML = "";
            attachWarning.textContent = "";
            attachSummary.textContent = "";

            if (!selectedFiles.length) return;

            let total = selectedFiles.reduce((sum, f) => sum + f.size, 0);
            const { tooMany, tooLarge } = validateFiles(selectedFiles);

            selectedFiles.forEach((f, idx) => {
              const li = document.createElement("li");
              li.className = "attachItem";
              li.innerHTML = `
                <div class="attachLeft">
                  <span class="attachName" title="${escapeHtml(f.name)}">${escapeHtml(f.name)}</span>
                  <span class="attachMeta">${fmtBytes(f.size)}</span>
                </div>
                <button type="button" class="btnMini" data-remove="${idx}" aria-label="Remove ${escapeHtml(f.name)}">
                  Remove
                </button>
              `;
              attachList.appendChild(li);
            });

            attachSummary.textContent = `Selected: ${selectedFiles.length} file(s) • Total: ${fmtBytes(total)}`;

            if (tooMany) {
              attachWarning.textContent = `Too many files. Please keep it to ${MAX_FILES} max.`;
            } else if (tooLarge) {
              attachWarning.textContent = `One or more files exceed ${MAX_MB} MB. Please compress or remove them.`;
            }
          }

          function addFiles(newOnes) {
            // merge while keeping order; also avoid duplicates by name+size+lastModified
            const merged = [...selectedFiles];
            for (const f of newOnes) {
              const key = `${f.name}|${f.size}|${f.lastModified}`;
              const exists = merged.some((x) => `${x.name}|${x.size}|${x.lastModified}` === key);
              if (!exists) merged.push(f);
            }
            selectedFiles = merged;
          }

          fileInput.addEventListener("change", () => {
            const picked = fileInput.files ? Array.from(fileInput.files) : [];
            addFiles(picked);

            // reset the input so user can re-pick the same file if they removed it
            fileInput.value = "";
            renderFiles();
          });

          attachList.addEventListener("click", (e) => {
            const btn = e.target.closest("button[data-remove]");
            if (!btn) return;
            const idx = Number(btn.getAttribute("data-remove"));
            if (Number.isNaN(idx)) return;

            selectedFiles.splice(idx, 1);
            renderFiles();
          });

          form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const { tooMany, tooLarge } = validateFiles(selectedFiles);
            if (tooMany) {
              status.textContent = `Please attach up to ${MAX_FILES} files max.`;
              return;
            }
            if (tooLarge) {
              status.textContent = `One or more files are larger than ${MAX_MB} MB.`;
              return;
            }

            status.textContent = "Sending…";
            submitBtn.disabled = true;

            // Build FormData manually (so we can include our selectedFiles list)
            const fd = new FormData();
            fd.append("email", form.email.value);
            fd.append("category", form.category.value);
            fd.append("subject", form.subject.value);
            fd.append("message", form.message.value);

            for (const f of selectedFiles) {
              fd.append("attachments", f, f.name);
            }

            let res, text;
            try {
              res = await fetch("/api/contact", { method: "POST", body: fd });
              text = await res.text();
            } catch (err) {
              status.textContent = "Network error. Please try again.";
              submitBtn.disabled = false;
              return;
            }

            if (res.ok) {
              status.textContent = "Message sent successfully ✔";
              form.reset();
              selectedFiles = [];
              renderFiles();
            } else {
              status.textContent = `Error (${res.status}): ${text || "Please try again."}`;
            }

            submitBtn.disabled = false;
          });

          renderFiles();
        });
      </script>

      <!-- CONTACT CARD -->
      <section class="section section--divider">
        <div class="container">
          <div class="grid1" style="max-width: 640px; margin: 0 auto;">
            <div class="card card--info" style="text-align:center;">
              <h2 class="h3">OR</h2>
              <p class="p" style="margin-top: 8px;">
                Reach us anytime via email:
              </p>

              <p class="p" style="margin-top: 10px;">
                <a href="mailto:support@actifly.app" class="btn btn--link">
                  support@actifly.app
                </a>
              </p>

              <p class="small" style="margin-top: 12px;">
                We usually reply within 24–48 hours on business days.
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- CTA -->
      <section class="section section--divider">
        <div class="container">
          <div class="cta">
            <div class="sectionHeader" style="margin-bottom: 12px;">
              <h2 class="h2">Looking for quick answers?</h2>
              <p class="p">You might already find what you’re looking for.</p>
            </div>

            <div class="actions">
              <a class="btn btn--primary" href="/en/faq/">Read FAQ</a>
              <a class="btn btn--ghost" href="/en/">Back home</a>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="siteFooter">
      <div class="container">
        <div class="footer">
          <div>© <span id="year"></span> ActiFly</div>
          <div style="display:flex; gap:14px; flex-wrap:wrap;">
            <a href="/en/legal/privacy/">Privacy</a>
            <a href="/en/legal/terms/">Terms</a>
          </div>
        </div>
      </div>
    </footer>

    <script>
      document.getElementById("year").textContent = new Date().getFullYear();
    </script>

    <script src="/app.js" defer></script>
  </body>
</html>
